<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Console | MB Eureka</title>
    <link rel="stylesheet" href="../assets/styles/main.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav class="navbar-admin">
        <div class="brand">MB Eureka <span class="badge-admin">ADMIN</span></div>
        <div class="nav-right">
            <span id="adminName" class="admin-user">Administrador</span>
            <button id="btnLogout" class="btn-logout-admin">Salir</button>
        </div>
    </nav>

    <div class="container-admin">
        <div class="dashboard-header">
            <h1>Panel de Control</h1>
            <p class="text-muted">Gesti√≥n integral de cartera e inversiones.</p>
        </div>

        <div class="admin-grid">
            <div class="card admin-card action-card">
                <div class="card-icon">üîç</div>
                <h3>Gesti√≥n de Cartera</h3>
                <div class="search-section">
                    <div class="search-wrapper">
                        <input type="text" id="inputBuscador" placeholder="üîç Buscar por Nombre, DNI..." autocomplete="off" style="width: 100%;">
                    </div>
                    <div id="listaResultados" class="results-list hidden"></div>
                </div>
            </div>

            <div class="card admin-card">
                <div class="card-icon">‚ú®</div>
                <h3>Operaciones</h3>
                <div style="display: flex; gap: 10px; margin-top: auto;">
                    <button id="btnNuevaInversion" class="btn-admin-primary" style="flex:1;">Nueva Carpeta</button>
                    <button id="btnAbrirBuscadorReingreso" class="btn-admin-outline" style="flex:1;">Cargar Reingreso</button>
                </div>
            </div>

            <div class="card admin-card">
                <div class="card-icon">üí∞</div>
                <h3>Tesorer√≠a (Este Mes)</h3>
                <div class="treasury-preview">
                    <span style="font-size:0.9rem; color:#666; display:block;">Total a Pagar:</span>
                    <span id="kpiTesoreriaMes" class="t-amount-big">-</span>
                </div>
                <button id="btnAbrirTesoreria" class="btn-text" style="margin-top:auto;">Ver Detalle Mensual ‚Üí</button>
            </div>
        </div>
    </div>

    <div id="adminModal" class="overlay hidden">
        <div class="popup">
            <div class="modal-header-row">
                <h3 id="modalTitle">Cliente</h3>
                <span id="closeModal" class="close-x">&times;</span>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <div id="modalNuevaInversion" class="overlay hidden">
        <div class="popup" style="max-width: 650px;">
            <div class="modal-header-row">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div class="icon-box-header">‚ú®</div><h3 style="margin:0;">Nueva Inversi√≥n</h3>
                </div>
                <span onclick="document.getElementById('modalNuevaInversion').classList.add('hidden')" class="close-x">&times;</span>
            </div>
            <form id="formNuevaCarpeta" class="admin-form-body">
                <div class="grid-form">
                    <div class="form-group">
                        <label class="admin-label">Nombre y Apellido</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="newNombre" class="admin-input" required placeholder="Ej: Juan Perez" autocomplete="off">
                            <div id="listaSugNombre" class="autocomplete-list hidden"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="admin-label">DNI</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="newDni" class="admin-input" required placeholder="Sin puntos" autocomplete="off">
                            <div id="listaSugDni" class="autocomplete-list hidden"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="admin-label">Capital Invertido (USD)</label>
                        <div class="input-icon-wrapper"><span class="input-icon">$</span><input type="number" id="newCapital" class="admin-input has-icon" required step="0.01"></div>
                    </div>
                    <div class="form-group"><label class="admin-label">Tasa de Inter√©s (%)</label><input type="number" id="newTasa" class="admin-input" required step="0.1"></div>
                    <div style="grid-column: span 2; display: flex; gap: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label class="admin-label">Plazo (Meses)</label>
                            <select id="newPlazoSelect" class="admin-input">
                                <option value="12">12 Meses</option><option value="18">18 Meses</option><option value="24">24 Meses</option><option value="otro" style="color:var(--admin-accent); font-weight:bold;">Personalizado...</option>
                            </select>
                        </div>
                        <div id="divPlazoOtro" class="form-group" style="flex: 1; display: none;">
                            <label class="admin-label">Especifique Meses</label>
                            <input type="number" id="newPlazoInput" class="admin-input">
                        </div>
                    </div>
                    <div class="form-group"><label class="admin-label">Unidad de Negocio</label><select id="newUnidad" class="admin-input" required></select></div>
                    <div class="form-group"><label class="admin-label">Fecha de Inicio</label><input type="date" id="newFecha" class="admin-input" required></div>
                </div>
                <div class="id-preview-container">
                    <small class="preview-label">ID DE CARPETA (AUTOGENERADO)</small>
                    <div class="id-display-box"><span id="idDisplay" class="id-placeholder">SELECCIONE UNIDAD</span></div>
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="document.getElementById('modalNuevaInversion').classList.add('hidden')" class="btn-admin-outline">Cancelar</button>
                    <button type="submit" class="btn-admin-primary">Crear Carpeta</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalBuscadorReingreso" class="overlay hidden">
        <div class="popup" style="max-width: 600px;">
            <div class="modal-header-row">
                <h3 id="tituloModalReingreso">Seleccionar Inversor</h3>
                <span onclick="document.getElementById('modalBuscadorReingreso').classList.add('hidden')" class="close-x">&times;</span>
            </div>
            <div id="paso1_Busqueda">
                <div class="search-wrapper" style="margin-bottom: 20px;">
                    <input type="text" id="inputBuscarReingreso" class="admin-input" placeholder="üîç Buscar Inversor por Nombre o DNI..." autocomplete="off">
                </div>
                <div id="listaResultadosReingreso" class="results-list-static"></div>
            </div>
            <div id="paso2_Seleccion" class="hidden">
                <div style="margin-bottom: 15px;">
                    <button id="btnVolverBusqueda" class="btn-text">‚Üê Volver a b√∫squeda</button>
                    <p style="color:#666; font-size:0.9rem; margin-top:5px;">Selecciona la carpeta destino:</p>
                </div>
                <div id="listaCarpetasDelUsuario" class="admin-folders-list"></div>
            </div>
        </div>
    </div>

    <div id="modalFormReingreso" class="overlay hidden">
        <div class="popup" style="max-width: 500px;">
            <div class="modal-header-row">
                <h3>Cargar Reingreso</h3>
                <span onclick="document.getElementById('modalFormReingreso').classList.add('hidden')" class="close-x">&times;</span>
            </div>
            
            <div class="folder-preview-header" id="headerReingreso">
                </div>

            <form id="formReingreso" class="admin-form-body">
                <div class="grid-form">
                    <div class="form-group">
                        <label class="admin-label">Capital a Ingresar (USD)</label>
                        <div class="input-icon-wrapper">
                            <span class="input-icon">$</span>
                            <input type="number" id="reingresoMonto" class="admin-input has-icon" required step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="admin-label">Nueva Tasa (%)</label>
                        <input type="number" id="reingresoTasa" class="admin-input" required step="0.1">
                    </div>

                    <div class="form-group">
                        <label class="admin-label">Fecha de Ingreso</label>
                        <input type="date" id="reingresoFecha" class="admin-input" required>
                    </div>

                    <div class="form-group">
                        <label class="admin-label">Extender Plazo (Meses)</label>
                        <input type="number" id="reingresoPlazo" class="admin-input" placeholder="Ej: 12" value="12">
                        <small style="color:#666; font-size:0.75rem;">Se sumar√°n al plazo actual.</small>
                    </div>
                </div>

                <div class="impact-preview">
                    <span style="font-size:1.5rem;">üìÖ</span>
                    <div>
                        <strong>Impacto en Cuota:</strong>
                        <div id="txtImpactoFecha" style="color:var(--admin-accent); font-weight:600;">Calculando...</div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" onclick="document.getElementById('modalFormReingreso').classList.add('hidden')" class="btn-admin-outline">Cancelar</button>
                    <button type="submit" class="btn-admin-primary">Confirmar Reingreso</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalPagosAdmin" class="overlay hidden">
        <div class="popup" style="max-width: 600px;">
            <div class="modal-header-row"><div id="headerPagosInfo"></div><span id="closeModalPagos" class="close-x">&times;</span></div>
            <div id="listaPagosAdmin" class="admin-payments-list"></div>
            <div style="margin-top: 15px; text-align: right;"><button onclick="document.getElementById('modalPagosAdmin').classList.add('hidden')" class="btn-admin-outline">Cerrar</button></div>
        </div>
    </div>

    <div id="modalNotificacion" class="overlay hidden">
        <div class="popup" style="max-width: 500px;">
            <div class="modal-header-row"><h3>Mensaje para el Cliente</h3><span id="closeNotif" class="close-x">&times;</span></div>
            <div style="padding-top: 10px;">
                <textarea id="txtNotificacion" class="admin-textarea" rows="4"></textarea>
                <div class="modal-footer"><button id="btnCancelNotif" class="btn-admin-outline">Cancelar</button><button id="btnSaveNotif" class="btn-admin-primary">Guardar</button></div>
            </div>
        </div>
    </div>

    <div id="modalFeedback" class="overlay hidden" style="z-index: 3000;">
        <div class="popup" style="max-width: 400px; text-align: center; padding: 30px;">
            <div id="fbIcon" style="font-size: 3rem; margin-bottom: 15px;">‚úÖ</div>
            <h3 id="fbTitle" style="margin-bottom: 10px;">¬°√âxito!</h3>
            <p id="fbMessage" style="color: #666; margin-bottom: 25px;">Operaci√≥n realizada.</p>
            <button onclick="document.getElementById('modalFeedback').classList.add('hidden')" class="btn-admin-primary full-width">Aceptar</button>
        </div>
    </div>

    <div id="modalTesoreria" class="overlay hidden">
        <div class="popup" style="max-width: 800px;">
            <div class="modal-header-row">
                <h3>Tesorer√≠a del Mes</h3>
                <span onclick="document.getElementById('modalTesoreria').classList.add('hidden')" class="close-x">&times;</span>
            </div>
            
            <div style="padding: 0 25px 15px 25px; background:#f9f9f9; border-bottom:1px solid #eee;">
                <p style="margin:0 0 10px 0; font-size:0.9rem; color:#666;">Total a liquidar este mes: <strong id="totalTesoreriaModal" style="color:var(--admin-accent); font-size:1.1rem;">-</strong></p>
                
                <input type="text" id="filtroTesoreria" class="admin-input" placeholder="üîç Filtrar por cliente..." style="padding:8px; font-size:0.9rem;">
            </div>

            <div id="listaTesoreria" class="admin-payments-list" style="padding:20px; max-height: 500px;">
                </div>
            
            <div style="margin-top: 15px; text-align: right; padding: 0 25px 20px 25px;">
                <button onclick="document.getElementById('modalTesoreria').classList.add('hidden')" class="btn-admin-outline">Cerrar</button>
            </div>
        </div>
    </div>
    <script type="module" src="main.js"></script>
</body>
</html>